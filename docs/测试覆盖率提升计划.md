# æçŒ«ç›´æ’­åŠ©æ‰‹ - æµ‹è¯•è¦†ç›–ç‡æå‡è®¡åˆ’

## ğŸ“Š ç°çŠ¶åˆ†æ

### å½“å‰æµ‹è¯•è¦†ç›–ç‡: 7%
```
æ€»ä½“ç»Ÿè®¡:
- æ€»ä»£ç è¡Œæ•°: 4,310è¡Œ
- å·²æµ‹è¯•è¡Œæ•°: 299è¡Œ
- æœªæµ‹è¯•è¡Œæ•°: 4,011è¡Œ

æ¨¡å—åˆ†å¸ƒ:
- AST_module: ~15% (éƒ¨åˆ†åŠŸèƒ½æµ‹è¯•)
- serveræ¨¡å—: ~5% (ä¸»è¦æ˜¯ç©ºæ–‡ä»¶)
- å‰ç«¯ä»£ç : 0% (æœªåŒ…å«åœ¨ç»Ÿè®¡ä¸­)
```

### æµ‹è¯•ç°çŠ¶é—®é¢˜
1. **å¼‚æ­¥å‡½æ•°æµ‹è¯•å¤±è´¥**: pytestä¸æ”¯æŒåŸç”Ÿå¼‚æ­¥æµ‹è¯•
2. **å•å…ƒæµ‹è¯•ç¼ºå¤±**: ä»…æœ‰ç®€å•çš„é›†æˆæµ‹è¯•
3. **è¾¹ç•Œæ¡ä»¶æœªè¦†ç›–**: ç¼ºå°‘å¼‚å¸¸åœºæ™¯æµ‹è¯•
4. **Mockä½¿ç”¨ä¸è¶³**: å¤–éƒ¨ä¾èµ–æœªéš”ç¦»

---

## ğŸ¯ ç›®æ ‡è®¾å®š

### é˜¶æ®µæ€§ç›®æ ‡
| é˜¶æ®µ | æ—¶é—´ | è¦†ç›–ç‡ç›®æ ‡ | é‡ç‚¹æ¨¡å— |
|------|------|-----------|----------|
| ç¬¬1é˜¶æ®µ | 1å‘¨ | 30% | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ |
| ç¬¬2é˜¶æ®µ | 2å‘¨ | 50% | APIæ¥å£å±‚ |
| ç¬¬3é˜¶æ®µ | 3å‘¨ | 70% | æ•°æ®å¤„ç†å±‚ |
| ç¬¬4é˜¶æ®µ | 4å‘¨ | 80% | å®Œæ•´ç³»ç»Ÿ |

### è´¨é‡æ ‡å‡†
- **å•å…ƒæµ‹è¯•**: è¦†ç›–æ‰€æœ‰å…¬å…±æ–¹æ³•
- **é›†æˆæµ‹è¯•**: è¦†ç›–ä¸»è¦ä¸šåŠ¡æµç¨‹
- **è¾¹ç•Œæµ‹è¯•**: è¦†ç›–å¼‚å¸¸å’Œè¾¹ç•Œæ¡ä»¶
- **æ€§èƒ½æµ‹è¯•**: å…³é”®æ¥å£æ€§èƒ½éªŒè¯

---

## ğŸ”§ æŠ€æœ¯å‡†å¤‡

### 1. æµ‹è¯•ç¯å¢ƒé…ç½®

#### å®‰è£…æµ‹è¯•ä¾èµ–
```bash
# å®‰è£…pytestå¼‚æ­¥æ”¯æŒ
pip install pytest-asyncio pytest-mock pytest-cov

# å®‰è£…HTTPæµ‹è¯•å®¢æˆ·ç«¯
pip install httpx

# å®‰è£…æ•°æ®åº“æµ‹è¯•æ”¯æŒ
pip install pytest-postgresql

# æ›´æ–°requirements-test.txt
cat > requirements-test.txt << EOF
pytest>=7.4.0
pytest-asyncio>=0.21.0
pytest-mock>=3.11.0
pytest-cov>=4.1.0
httpx>=0.24.0
pytest-postgresql>=5.0.0
factory-boy>=3.3.0
faker>=19.0.0
EOF
```

#### pytesté…ç½®æ–‡ä»¶
```ini
# pytest.ini
[tool:pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = 
    --strict-markers
    --strict-config
    --cov=server
    --cov=AST_module
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml
    --cov-fail-under=80
asyncio_mode = auto
markers =
    unit: å•å…ƒæµ‹è¯•
    integration: é›†æˆæµ‹è¯•
    slow: æ…¢é€Ÿæµ‹è¯•
    external: éœ€è¦å¤–éƒ¨ä¾èµ–çš„æµ‹è¯•
```

### 2. æµ‹è¯•ç»“æ„è®¾è®¡

#### ç›®å½•ç»“æ„
```
tests/
â”œâ”€â”€ conftest.py              # å…¨å±€é…ç½®å’Œfixture
â”œâ”€â”€ unit/                    # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_validators.py
â”‚   â”œâ”€â”€ test_config.py
â”‚   â”œâ”€â”€ test_helpers.py
â”‚   â””â”€â”€ test_models.py
â”œâ”€â”€ integration/             # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_api_endpoints.py
â”‚   â”œâ”€â”€ test_websocket.py
â”‚   â””â”€â”€ test_database.py
â”œâ”€â”€ fixtures/                # æµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ sample_comments.json
â”‚   â””â”€â”€ test_config.yaml
â””â”€â”€ test_helpers/              # æµ‹è¯•è¾…åŠ©å·¥å…·
    â”œâ”€â”€ ai_service_helper.py
    â””â”€â”€ database_helper.py
```

---

## ğŸ“ æµ‹è¯•å®æ–½è®¡åˆ’

### ç¬¬1é˜¶æ®µ: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æµ‹è¯• (ç›®æ ‡30%)

#### 1.1 æ•°æ®éªŒè¯å™¨æµ‹è¯•
```python
# tests/unit/test_validators.py
import pytest
from server.utils.validators import (
    CommentValidator, 
    ValidationError,
    sanitize_input
)

class TestCommentValidator:
    def test_valid_comment(self):
        """æµ‹è¯•æœ‰æ•ˆè¯„è®ºéªŒè¯"""
        validator = CommentValidator()
        data = {
            "user": "æµ‹è¯•ç”¨æˆ·",
            "content": "è¿™æ˜¯ä¸€æ¡æµ‹è¯•è¯„è®º",
            "timestamp": 1640995200
        }
        result = validator.validate(data)
        assert result["user"] == "æµ‹è¯•ç”¨æˆ·"
        assert result["content"] == "è¿™æ˜¯ä¸€æ¡æµ‹è¯•è¯„è®º"
    
    def test_empty_user_raises_error(self):
        """æµ‹è¯•ç©ºç”¨æˆ·åæŠ›å‡ºå¼‚å¸¸"""
        validator = CommentValidator()
        with pytest.raises(ValidationError, match="ç”¨æˆ·åä¸èƒ½ä¸ºç©º"):
            validator.validate({"user": "", "content": "test"})
    
    def test_long_content_truncated(self):
        """æµ‹è¯•é•¿å†…å®¹è¢«æˆªæ–­"""
        validator = CommentValidator()
        long_content = "x" * 1001
        data = {"user": "test", "content": long_content}
        result = validator.validate(data)
        assert len(result["content"]) <= 1000
    
    @pytest.mark.parametrize("malicious_input,expected", [
        ("<script>alert('xss')</script>", "alert('xss')"),
        ("javascript:void(0)", "void(0)"),
        ("<img src=x onerror=alert(1)>", ""),
    ])
    def test_xss_protection(self, malicious_input, expected):
        """æµ‹è¯•XSSé˜²æŠ¤"""
        result = sanitize_input(malicious_input)
        assert expected in result or result == ""
```

#### 1.2 é…ç½®ç®¡ç†æµ‹è¯•
```python
# tests/unit/test_config.py
import pytest
import os
from unittest.mock import patch
from server.config import ServerConfig, DatabaseConfig, get_settings

class TestServerConfig:
    def test_default_config(self):
        """æµ‹è¯•é»˜è®¤é…ç½®"""
        config = ServerConfig()
        assert config.host == "0.0.0.0"
        assert config.port == 10090
        assert config.debug is False
    
    @patch.dict(os.environ, {"HOST": "127.0.0.1", "PORT": "9000"})
    def test_env_override(self):
        """æµ‹è¯•ç¯å¢ƒå˜é‡è¦†ç›–"""
        config = ServerConfig()
        assert config.host == "127.0.0.1"
        assert config.port == 9000
    
    def test_database_config_validation(self):
        """æµ‹è¯•æ•°æ®åº“é…ç½®éªŒè¯"""
        with pytest.raises(ValueError):
            DatabaseConfig(host="", port=0)

class TestSettingsFactory:
    def test_get_settings_singleton(self):
        """æµ‹è¯•è®¾ç½®å•ä¾‹æ¨¡å¼"""
        settings1 = get_settings()
        settings2 = get_settings()
        assert settings1 is settings2
```

#### 1.3 å·¥å…·å‡½æ•°æµ‹è¯•
```python
# tests/unit/test_helpers.py
import pytest
from datetime import datetime
from server.utils.helpers import (
    format_timestamp,
    generate_cache_key,
    safe_json_loads
)

class TestHelperFunctions:
    def test_format_timestamp(self):
        """æµ‹è¯•æ—¶é—´æˆ³æ ¼å¼åŒ–"""
        timestamp = 1640995200  # 2022-01-01 00:00:00 UTC
        result = format_timestamp(timestamp)
        assert "2022-01-01" in result
    
    def test_generate_cache_key(self):
        """æµ‹è¯•ç¼“å­˜é”®ç”Ÿæˆ"""
        key = generate_cache_key("user", "123", "comments")
        assert key == "user:123:comments"
        
        # æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å¤„ç†
        key = generate_cache_key("user:name", "test@email.com")
        assert ":" not in key.split(":")[1]  # ç‰¹æ®Šå­—ç¬¦è¢«å¤„ç†
    
    @pytest.mark.parametrize("json_str,expected", [
        ('{"key": "value"}', {"key": "value"}),
        ('invalid json', None),
        ('null', None),
        ('[]', []),
    ])
    def test_safe_json_loads(self, json_str, expected):
        """æµ‹è¯•å®‰å…¨JSONè§£æ"""
        result = safe_json_loads(json_str)
        assert result == expected
```

### ç¬¬2é˜¶æ®µ: APIæ¥å£æµ‹è¯• (ç›®æ ‡50%)

#### 2.1 FastAPIç«¯ç‚¹æµ‹è¯•
```python
# tests/integration/test_api_endpoints.py
import pytest
from httpx import AsyncClient
from server.main import app

@pytest.mark.asyncio
class TestCommentAPI:
    async def test_create_comment_success(self):
        """æµ‹è¯•åˆ›å»ºè¯„è®ºæˆåŠŸ"""
        async with AsyncClient(app=app, base_url="http://test") as ac:
            response = await ac.post("/api/comments", json={
                "user": "æµ‹è¯•ç”¨æˆ·",
                "content": "æµ‹è¯•è¯„è®ºå†…å®¹"
            })
        assert response.status_code == 201
        data = response.json()
        assert data["user"] == "æµ‹è¯•ç”¨æˆ·"
        assert "id" in data
    
    async def test_create_comment_validation_error(self):
        """æµ‹è¯•åˆ›å»ºè¯„è®ºéªŒè¯é”™è¯¯"""
        async with AsyncClient(app=app, base_url="http://test") as ac:
            response = await ac.post("/api/comments", json={
                "user": "",  # ç©ºç”¨æˆ·å
                "content": "æµ‹è¯•å†…å®¹"
            })
        assert response.status_code == 422
        assert "ç”¨æˆ·åä¸èƒ½ä¸ºç©º" in response.text
    
    async def test_get_comments_pagination(self):
        """æµ‹è¯•è¯„è®ºåˆ†é¡µæŸ¥è¯¢"""
        async with AsyncClient(app=app, base_url="http://test") as ac:
            response = await ac.get("/api/comments?page=1&size=10")
        assert response.status_code == 200
        data = response.json()
        assert "items" in data
        assert "total" in data
        assert "page" in data
    
    async def test_rate_limiting(self):
        """æµ‹è¯•é¢‘ç‡é™åˆ¶"""
        async with AsyncClient(app=app, base_url="http://test") as ac:
            # å¿«é€Ÿå‘é€å¤šä¸ªè¯·æ±‚
            for i in range(15):
                response = await ac.post("/api/comments", json={
                    "user": f"user{i}",
                    "content": f"content{i}"
                })
                if i < 10:
                    assert response.status_code in [201, 422]
                else:
                    # è¶…è¿‡é™åˆ¶ååº”è¯¥è¿”å›429
                    assert response.status_code == 429
```

#### 2.2 WebSocketæµ‹è¯•
```python
# tests/integration/test_websocket.py
import pytest
import asyncio
from fastapi.testclient import TestClient
from server.main import app

@pytest.mark.asyncio
class TestWebSocketConnection:
    def test_websocket_connection(self):
        """æµ‹è¯•WebSocketè¿æ¥"""
        client = TestClient(app)
        with client.websocket_connect("/ws") as websocket:
            # å‘é€æµ‹è¯•æ¶ˆæ¯
            websocket.send_json({"type": "ping"})
            data = websocket.receive_json()
            assert data["type"] == "pong"
    
    def test_websocket_comment_broadcast(self):
        """æµ‹è¯•è¯„è®ºå¹¿æ’­"""
        client = TestClient(app)
        with client.websocket_connect("/ws") as websocket:
            # æ¨¡æ‹Ÿæ–°è¯„è®º
            test_comment = {
                "user": "æµ‹è¯•ç”¨æˆ·",
                "content": "æµ‹è¯•è¯„è®º",
                "timestamp": 1640995200
            }
            
            # è¿™é‡Œéœ€è¦è§¦å‘è¯„è®ºåˆ›å»ºäº‹ä»¶
            # ç„¶åéªŒè¯WebSocketæ”¶åˆ°å¹¿æ’­
            data = websocket.receive_json()
            assert data["type"] == "new_comment"
            assert data["data"]["user"] == "æµ‹è¯•ç”¨æˆ·"
```

### ç¬¬3é˜¶æ®µ: æ•°æ®å¤„ç†å±‚æµ‹è¯• (ç›®æ ‡70%)

#### 3.1 AIæœåŠ¡æµ‹è¯•
```python
# tests/unit/test_ai_services.py
import pytest
from unittest.mock import AsyncMock, patch
from server.ai.generator import CommentGenerator
from server.ai.tip_generator import TipGenerator

@pytest.mark.asyncio
class TestCommentGenerator:
    @patch('server.ai.generator.openai_client')
    async def test_generate_comment_success(self, mock_client):
        """æµ‹è¯•è¯„è®ºç”ŸæˆæˆåŠŸ"""
        # Mock OpenAIå“åº”
        mock_client.chat.completions.create.return_value = AsyncMock()
        mock_client.chat.completions.create.return_value.choices = [
            AsyncMock(message=AsyncMock(content="ç”Ÿæˆçš„è¯„è®ºå†…å®¹"))
        ]
        
        generator = CommentGenerator()
        result = await generator.generate_comment("ç›´æ’­ä¸»é¢˜")
        
        assert result == "ç”Ÿæˆçš„è¯„è®ºå†…å®¹"
        mock_client.chat.completions.create.assert_called_once()
    
    @patch('server.ai.generator.openai_client')
    async def test_generate_comment_api_error(self, mock_client):
        """æµ‹è¯•APIé”™è¯¯å¤„ç†"""
        mock_client.chat.completions.create.side_effect = Exception("APIé”™è¯¯")
        
        generator = CommentGenerator()
        with pytest.raises(Exception, match="APIé”™è¯¯"):
            await generator.generate_comment("ç›´æ’­ä¸»é¢˜")
    
    async def test_generate_comment_empty_topic(self):
        """æµ‹è¯•ç©ºä¸»é¢˜å¤„ç†"""
        generator = CommentGenerator()
        with pytest.raises(ValueError, match="ä¸»é¢˜ä¸èƒ½ä¸ºç©º"):
            await generator.generate_comment("")
```

#### 3.2 æ•°æ®åº“æ“ä½œæµ‹è¯•
```python
# tests/integration/test_database.py
import pytest
from server.models import Comment, User
from server.database import get_db_session

@pytest.mark.asyncio
class TestDatabaseOperations:
    async def test_create_comment(self, db_session):
        """æµ‹è¯•åˆ›å»ºè¯„è®º"""
        comment_data = {
            "user": "æµ‹è¯•ç”¨æˆ·",
            "content": "æµ‹è¯•è¯„è®ºå†…å®¹",
            "timestamp": 1640995200
        }
        
        comment = Comment(**comment_data)
        db_session.add(comment)
        await db_session.commit()
        
        assert comment.id is not None
        assert comment.user == "æµ‹è¯•ç”¨æˆ·"
    
    async def test_query_comments_by_user(self, db_session):
        """æµ‹è¯•æŒ‰ç”¨æˆ·æŸ¥è¯¢è¯„è®º"""
        # åˆ›å»ºæµ‹è¯•æ•°æ®
        comments = [
            Comment(user="user1", content="content1"),
            Comment(user="user1", content="content2"),
            Comment(user="user2", content="content3"),
        ]
        
        for comment in comments:
            db_session.add(comment)
        await db_session.commit()
        
        # æŸ¥è¯¢user1çš„è¯„è®º
        user1_comments = await db_session.query(Comment).filter(
            Comment.user == "user1"
        ).all()
        
        assert len(user1_comments) == 2
        assert all(c.user == "user1" for c in user1_comments)
```

### ç¬¬4é˜¶æ®µ: å®Œæ•´ç³»ç»Ÿæµ‹è¯• (ç›®æ ‡80%)

#### 4.1 ç«¯åˆ°ç«¯æµ‹è¯•
```python
# tests/e2e/test_complete_workflow.py
import pytest
from httpx import AsyncClient
from server.main import app

@pytest.mark.asyncio
class TestCompleteWorkflow:
    async def test_comment_lifecycle(self):
        """æµ‹è¯•è¯„è®ºå®Œæ•´ç”Ÿå‘½å‘¨æœŸ"""
        async with AsyncClient(app=app, base_url="http://test") as ac:
            # 1. åˆ›å»ºè¯„è®º
            create_response = await ac.post("/api/comments", json={
                "user": "æµ‹è¯•ç”¨æˆ·",
                "content": "æµ‹è¯•è¯„è®ºå†…å®¹"
            })
            assert create_response.status_code == 201
            comment_id = create_response.json()["id"]
            
            # 2. æŸ¥è¯¢è¯„è®º
            get_response = await ac.get(f"/api/comments/{comment_id}")
            assert get_response.status_code == 200
            comment_data = get_response.json()
            assert comment_data["user"] == "æµ‹è¯•ç”¨æˆ·"
            
            # 3. æ›´æ–°è¯„è®º
            update_response = await ac.put(f"/api/comments/{comment_id}", json={
                "content": "æ›´æ–°åçš„å†…å®¹"
            })
            assert update_response.status_code == 200
            
            # 4. åˆ é™¤è¯„è®º
            delete_response = await ac.delete(f"/api/comments/{comment_id}")
            assert delete_response.status_code == 204
            
            # 5. éªŒè¯åˆ é™¤
            get_deleted_response = await ac.get(f"/api/comments/{comment_id}")
            assert get_deleted_response.status_code == 404
```

---

## ğŸ§ª æµ‹è¯•å·¥å…·å’Œæ¡†æ¶

### 1. Fixtureç®¡ç†
```python
# tests/conftest.py
import pytest
import asyncio
from httpx import AsyncClient
from server.main import app
from server.database import get_db_session, create_test_database

@pytest.fixture(scope="session")
def event_loop():
    """åˆ›å»ºäº‹ä»¶å¾ªç¯"""
    loop = asyncio.get_event_loop_policy().new_event_loop()
    yield loop
    loop.close()

@pytest.fixture
async def db_session():
    """æ•°æ®åº“ä¼šè¯fixture"""
    session = await create_test_database()
    yield session
    await session.close()

@pytest.fixture
async def client():
    """HTTPå®¢æˆ·ç«¯fixture"""
    async with AsyncClient(app=app, base_url="http://test") as ac:
        yield ac

@pytest.fixture
def sample_comment():
    """ç¤ºä¾‹è¯„è®ºæ•°æ®"""
    return {
        "user": "æµ‹è¯•ç”¨æˆ·",
        "content": "è¿™æ˜¯ä¸€æ¡æµ‹è¯•è¯„è®º",
        "timestamp": 1640995200
    }
```

### 2. æµ‹è¯•è¾…åŠ©å·¥å…·
```python
# tests/test_helpers/ai_service_helper.py
from unittest.mock import AsyncMock

class AIServiceHelper:
    def __init__(self):
        self.generate_comment = AsyncMock(return_value="æ¨¡æ‹Ÿç”Ÿæˆçš„è¯„è®º")
        self.analyze_sentiment = AsyncMock(return_value="positive")
        self.extract_keywords = AsyncMock(return_value=["å…³é”®è¯1", "å…³é”®è¯2"])

@pytest.fixture
def ai_service_helper():
    return AIServiceHelper()
```

### 3. æ•°æ®å·¥å‚
```python
# tests/factories.py
import factory
from server.models import Comment, User

class CommentFactory(factory.Factory):
    class Meta:
        model = Comment
    
    user = factory.Sequence(lambda n: f"user{n}")
    content = factory.Faker('text', max_nb_chars=200)
    timestamp = factory.Faker('unix_time')

class UserFactory(factory.Factory):
    class Meta:
        model = User
    
    username = factory.Sequence(lambda n: f"user{n}")
    email = factory.Faker('email')
```

---

## ğŸ“Š æŒç»­é›†æˆé…ç½®

### GitHub Actionsé…ç½®
```yaml
# .github/workflows/test.yml
name: æµ‹è¯•å’Œè¦†ç›–ç‡æ£€æŸ¥

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:13
        env:
          POSTGRES_PASSWORD: postgres
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    
    steps:
    - uses: actions/checkout@v3
    
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: å®‰è£…ä¾èµ–
      run: |
        pip install -r requirements.txt
        pip install -r requirements-test.txt
    
    - name: è¿è¡Œæµ‹è¯•
      run: |
        pytest --cov=server --cov=AST_module --cov-report=xml
    
    - name: ä¸Šä¼ è¦†ç›–ç‡æŠ¥å‘Š
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.xml
        fail_ci_if_error: true
    
    - name: æ£€æŸ¥è¦†ç›–ç‡é˜ˆå€¼
      run: |
        pytest --cov=server --cov=AST_module --cov-fail-under=80
```

---

## ğŸ“ˆ ç›‘æ§å’ŒæŠ¥å‘Š

### 1. è¦†ç›–ç‡æŠ¥å‘Šç”Ÿæˆ
```bash
# ç”ŸæˆHTMLæŠ¥å‘Š
pytest --cov=server --cov=AST_module --cov-report=html

# ç”ŸæˆXMLæŠ¥å‘Šï¼ˆç”¨äºCIï¼‰
pytest --cov=server --cov=AST_module --cov-report=xml

# ç”Ÿæˆè¯¦ç»†çš„ç¼ºå¤±è¡ŒæŠ¥å‘Š
pytest --cov=server --cov=AST_module --cov-report=term-missing
```

### 2. æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿
```python
# scripts/generate_test_report.py
import json
from datetime import datetime

def generate_test_report(coverage_data, test_results):
    """ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š"""
    report = {
        "timestamp": datetime.now().isoformat(),
        "coverage": {
            "total": coverage_data.get("total", 0),
            "by_module": coverage_data.get("modules", {}),
            "target": 80
        },
        "tests": {
            "total": test_results.get("total", 0),
            "passed": test_results.get("passed", 0),
            "failed": test_results.get("failed", 0),
            "skipped": test_results.get("skipped", 0)
        },
        "recommendations": generate_recommendations(coverage_data)
    }
    
    with open("test_report.json", "w") as f:
        json.dump(report, f, indent=2, ensure_ascii=False)
    
    return report
```

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### é‡åŒ–æŒ‡æ ‡
- **æ€»ä½“è¦†ç›–ç‡**: â‰¥80%
- **æ ¸å¿ƒæ¨¡å—è¦†ç›–ç‡**: â‰¥90%
- **æµ‹è¯•é€šè¿‡ç‡**: 100%
- **æµ‹è¯•æ‰§è¡Œæ—¶é—´**: <5åˆ†é’Ÿ

### è´¨é‡æ ‡å‡†
- **è¾¹ç•Œæ¡ä»¶è¦†ç›–**: æ‰€æœ‰å¼‚å¸¸è·¯å¾„
- **Mockä½¿ç”¨**: å¤–éƒ¨ä¾èµ–å®Œå…¨éš”ç¦»
- **æµ‹è¯•ç‹¬ç«‹æ€§**: æµ‹è¯•é—´æ— ä¾èµ–
- **æ–‡æ¡£å®Œæ•´æ€§**: æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹æœ‰æ¸…æ™°è¯´æ˜

---

## ğŸ“… å®æ–½æ—¶é—´è¡¨

| å‘¨æ¬¡ | ä¸»è¦ä»»åŠ¡ | äº¤ä»˜ç‰© | è´Ÿè´£äºº |
|------|----------|--------|--------|
| ç¬¬1å‘¨ | ç¯å¢ƒæ­å»º + æ ¸å¿ƒé€»è¾‘æµ‹è¯• | 30%è¦†ç›–ç‡ | å¼€å‘å›¢é˜Ÿ |
| ç¬¬2å‘¨ | APIæ¥å£æµ‹è¯• | 50%è¦†ç›–ç‡ | å¼€å‘å›¢é˜Ÿ |
| ç¬¬3å‘¨ | æ•°æ®å¤„ç†å±‚æµ‹è¯• | 70%è¦†ç›–ç‡ | å¼€å‘å›¢é˜Ÿ |
| ç¬¬4å‘¨ | ç³»ç»Ÿæµ‹è¯• + ä¼˜åŒ– | 80%è¦†ç›–ç‡ | å…¨å›¢é˜Ÿ |

---

*æœ¬è®¡åˆ’å°†æ ¹æ®å®é™…æ‰§è¡Œæƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œç¡®ä¿åœ¨æå‡è¦†ç›–ç‡çš„åŒæ—¶ä¿è¯æµ‹è¯•è´¨é‡ã€‚*
