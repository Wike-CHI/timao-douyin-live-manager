# AI服务集成方案 - 共识阶段文档

## 需求描述

### 核心需求
1. **增强评论分析能力**
   - 实现实时热词提取和趋势分析
   - 提升情感分析准确率，支持细粒度情感分类
   - 自动识别和分类用户问题，支持问题优先级排序

2. **优化语音转文字功能**
   - 提高语音识别准确率，特别是在直播环境下的噪声处理
   - 支持多种ASR后端的动态切换和降级处理
   - 实现转录结果的后处理优化和实时纠错

### 扩展需求
1. **AI服务集成**
   - 支持主流AI服务提供商（DeepSeek、OpenAI等）
   - 实现AI服务的配置化管理
   - 提供AI服务调用的监控和统计功能

## 验收标准

### 评论分析验收标准
1. **热词分析**
   - 能够从直播评论中提取准确的热词，准确率≥90%
   - 支持热词趋势分析，能够识别上升/下降趋势词汇
   - 响应时间≤1秒

2. **情感分析**
   - 情感分类准确率≥85%
   - 支持正面、负面、中性及细分情感（兴奋、好奇、支持等）
   - 能够生成情感趋势报告

3. **问题识别**
   - 问题识别准确率≥90%
   - 支持问题分类（产品咨询、使用方法、价格等）
   - 能够按优先级排序问题

### 语音转文字验收标准
1. **识别准确率**
   - 中文识别准确率≥85%
   - 英文识别准确率≥80%
   - 支持中英文混合识别

2. **实时性能**
   - 端到端延迟≤2秒
   - 支持实时音频流处理
   - 转录结果置信度≥0.7

3. **鲁棒性**
   - 支持噪声环境下的识别
   - 支持多种音频输入格式
   - 具备ASR后端降级处理能力

## 技术实现方案

### 评论分析技术方案
1. **热词分析模块**
   - 基于jieba分词库进行中文分词
   - 集成TF-IDF和TextRank算法进行关键词提取
   - 建立直播领域专用停用词库

2. **情感分析模块**
   - 集成SnowNLP进行基础情感分析
   - 建立直播领域情感词典
   - 实现情感趋势分析功能

3. **问题识别模块**
   - 基于正则表达式识别疑问句
   - 使用NLP技术进行问题分类
   - 实现问题优先级排序算法

### 语音转文字技术方案
1. **ASR后端管理（当前版本约束）**
   - 本地仅支持 SenseVoiceSmall + VAD，禁止切换模型尺寸与模式；Medium/Large 仅支持通过云端 API（阿里云）
   - 优化本地模型与 VAD 路径管理，优先使用仓库内 models/ 目录，确保离线可用
   - 动态切换/降级机制在当前版本禁用（后续如接入云端或多后端再恢复）

2. **音频处理优化**
   - 增加音频预处理模块（降噪、增益控制）
   - 实现转录结果的后处理优化
   - 增加置信度阈值的动态调整机制

3. **实时处理机制**
   - 优化音频缓冲区管理
   - 实现高效的异步处理机制
   - 增加转录结果的实时纠错功能

## 依赖约束

1. **技术栈约束**
   - Python 3.8+
   - Flask/FastAPI后端框架
   - WebSocket实时通信
- SenseVoice 语音识别库及备用模型管理

2. **第三方服务依赖**
   - 可选的AI API服务（DeepSeek/OpenAI等）
   - jieba分词库
   - SnowNLP情感分析库
   - 相关NLP处理库

## 边界限制

1. **功能边界**
   - 仅处理当前直播间的评论和语音数据
   - 不涉及历史数据的批量处理
   - 不实现跨平台数据整合

2. **性能边界**
   - 单个直播间支持最大并发用户数为1000
   - 语音识别准确率目标为85%以上
   - 评论分析准确率目标为90%以上

## 不确定性解决方案

1. **AI服务选择**
   - 默认集成DeepSeek作为主要AI服务提供商
   - 支持OpenAI作为备选方案
   - 提供模拟数据模式以支持离线开发和测试

2. **部署环境**
   - 支持本地部署和云端部署
   - 提供Docker部署方案
   - 实现环境配置的动态加载

3. **成本控制**
   - 实现AI API调用频率限制
   - 提供缓存机制减少重复调用
   - 支持批量处理以优化API调用

4. **数据隐私**
   - 所有数据处理在本地进行
   - 不存储用户敏感信息
   - 提供数据清理机制
