# AI实时分析卡片 · 需求对齐文档

## 项目上下文分析

### 现有项目结构
- **项目名称**: timao-douyin-live-manager (提猫直播助手)
- **技术栈**: 
  - 前端: Electron + React + TypeScript
  - 后端: FastAPI + Python 3.11+
  - AI服务: OpenAI兼容接口 (Qwen/DeepSeek)
  - 数据采集: DouyinLiveWebFetcher + SenseVoice
- **现有架构模式**: 
  - Electron主进程 + 渲染进程
  - FastAPI后端服务 (端口8090)
  - WebSocket/SSE实时通信
  - 模块化插件设计

### 业务域理解
- **核心业务**: 直播间实时监测与AI分析
- **用户角色**: 直播主播
- **使用场景**: 直播过程中的实时状态监控和改进建议
- **数据来源**: 
  - 主播实时转录 (SenseVoice)
  - 直播间互动数据 (弹幕、礼物、点赞等)
  - 历史直播风格数据

## 需求理解确认

### 功能特性规范

#### 1. 直播状态监测卡片 (核心功能)
**当前状态**: 现有AI分析功能较为简单，主要显示亮点、风险、建议等文本信息
**目标状态**: 改造为结构化的状态监测卡片，包含：

1. **直播间氛围分析** (每分钟刷新)
   - 氛围评分: 数值化指标 (0-100)
   - 弹幕密度: 条/分钟 + 变化趋势
   - 互动率: 百分比指标
   - 观众留存: 状态描述

2. **主播状态分析**
   - 语速监测: 字/分钟
   - 停顿时长分析: 时长 + 建议
   - 话题连贯性: 评级

3. **风险提示系统**
   - 实时风险检测 (互动下降、冷场等)
   - 高频问题未回应提醒
   - 数据异常告警

4. **改进建议引擎**
   - 基于当前状态的具体建议
   - 个性化用户互动提醒
   - 节奏调整建议

#### 2. 话术生成机制变更
**当前状态**: AI自动生成话术并显示
**目标状态**: 
- AI不再自动生成话术
- 主播手动点击"生成话术"按钮
- 基于当前直播状态 + 历史风格 + 互动数据生成

### 非功能需求

#### 性能要求
- 卡片刷新频率: 每分钟更新一次
- 数据延迟: < 2秒
- UI响应时间: < 500ms
- 内存占用: 增量 < 50MB

#### 可用性要求
- 卡片布局清晰易读
- 关键指标突出显示
- 支持快速操作 (生成话术、查看详情等)
- 适配现有UI风格

#### 兼容性要求
- 兼容现有Electron架构
- 复用现有AI分析后端
- 保持现有WebSocket/SSE通信机制
- 不影响其他功能模块

## 需求澄清

### 明确范围
✅ **包含范围**:
- 重新设计AI分析卡片UI组件
- 优化后端AI分析数据结构
- 实现结构化状态监测指标
- 改造话术生成为手动触发
- 集成历史风格数据分析

❌ **不包含范围**:
- 不修改底层数据采集逻辑 (DouyinLiveWebFetcher)
- 不改变现有音频转录流程 (SenseVoice)
- 不涉及新的AI模型训练
- 不修改用户认证和支付系统

### 边界条件
- **数据依赖**: 需要实时转录和弹幕数据正常工作
- **AI服务**: 依赖现有OpenAI兼容接口可用
- **历史数据**: 需要访问用户历史直播风格数据
- **实时性**: 分析结果需要在合理时间内返回

### 潜在歧义点
1. **"每分钟刷新"** - 确认为固定60秒间隔，不可配置
2. **"氛围评分算法"** - 需要定义具体的计算逻辑
3. **"历史风格数据"** - 确认数据来源和存储方式
4. **"个性化建议"** - 确认个性化程度和实现方式

## 验收标准

### 功能验收
1. ✅ 卡片显示所有必需的监测指标
2. ✅ 每分钟自动刷新数据
3. ✅ 手动生成话术功能正常
4. ✅ 风险提示及时准确
5. ✅ 改进建议具有针对性

### 性能验收
1. ✅ 卡片刷新不影响其他功能
2. ✅ 内存使用在可接受范围内
3. ✅ 网络请求频率合理
4. ✅ UI响应流畅无卡顿

### 兼容性验收
1. ✅ 与现有功能无冲突
2. ✅ 保持现有API接口稳定
3. ✅ 支持现有的主题和样式
4. ✅ 错误处理和降级机制完善

## 技术约束

### 现有架构约束
- 必须使用React + TypeScript前端技术栈
- 必须复用现有FastAPI后端框架
- 必须保持现有的模块化设计原则
- 必须遵循现有的代码规范和项目结构

### 依赖约束
- AI分析依赖OpenAI兼容接口可用性
- 实时数据依赖WebSocket连接稳定性
- 历史数据依赖现有数据存储机制
- UI组件依赖现有样式系统

### 资源约束
- 开发时间: 预计3-5个工作日
- 测试覆盖: 需要覆盖主要功能场景
- 文档更新: 需要同步更新用户手册
- 向后兼容: 不能破坏现有用户体验

## 关键假设

1. **数据可用性**: 假设实时转录和弹幕数据质量稳定
2. **AI服务稳定性**: 假设OpenAI兼容接口响应时间 < 3秒
3. **用户使用模式**: 假设用户会主动查看和使用监测卡片
4. **历史数据**: 假设存在足够的历史数据用于风格分析

## 风险识别

### 技术风险
- AI分析结果准确性依赖数据质量
- 实时性要求可能影响系统性能
- 复杂UI可能增加维护成本

### 业务风险
- 用户可能不适应新的交互方式
- 过多信息可能造成认知负担
- 个性化建议可能不够准确

### 缓解策略
- 实现渐进式功能发布
- 提供用户反馈收集机制
- 保留原有功能作为备选方案