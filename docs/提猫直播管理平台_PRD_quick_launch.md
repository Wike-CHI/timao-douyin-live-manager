# 提猫直播管理平台 - 快速上线版 PRD

## 1. 发布背景

- 目标：在 一天内交付可上线的直播助手桌面版，覆盖抖音直播的实时听写、弹幕采集与 AI 提示能力。
- 依赖：复用现有 `AST_module`（语音转写）与 `DouyinLiveWebFetcher`（弹幕抓取），新增 DeepSeek V3.1 AILLM 驱动的智能分析。
- 成果：为主播提供实时冷场提示、直播过程中每 5 分钟的运营洞察，以及直播结束后的复盘报告。

## 2. 核心用户与痛点

| 角色      | 当前痛点                                 | 快速上线版价值                          |
| --------- | ---------------------------------------- | --------------------------------------- |
| 主播      | 忙于互动时无法关注数据、冷场难以把握节奏 | 实时弹幕+语音整合，自动脚本提示保节奏   |
| 运营助理  | 事后复盘耗时，缺乏客观数据支持           | 自动生成直播总结与改进方案              |
| 产品/技术 | 模块分散，缺乏统一交互                   | Electron 桌面端统一承载两个后端服务输出 |

## 3. MVP 范围

1. **实时数据采集**
   - Douyin 弹幕抓取：聊天、礼物、排行榜事件。
   - AST 语音转写：16kHz 中文语音转写，输出实时文本。
2. **AI 异步分析（DeepSeek V3.1 AILLM）**
   - 每 5 分钟聚合窗口：统计弹幕总量、礼物次数、热词，并融合主播讲话摘要。
   - 事件检测：基于窗口内弹幕数和语音情绪检测冷场（弹幕低于阈值且语音沉默 > 30 秒）。
   - 智能提示：输出 2 条以内的话术建议，按优先级推送给主播。
3. **直播复盘报告**
   - 会话结束触发：向 AILLM 发送全量弹幕摘要+语音转写文本。
   - 生成内容：直播成绩概览（互动、转化）、问题定位、下次精进建议（含 3 个行动项）。
4. **桌面端呈现**
   - 实时面板：弹幕流、转写字幕、AI 提示区域、5 分钟分析卡片。
   - 复盘报告：列表展示历史直播报告，可导出为 Markdown/TXT。

> 超出范围：多平台扩展、支付订阅、情绪图谱、移动端支持、团队协作。

## 4. 用户旅程

1. 主播/助理在 Electron 客户端输入抖音 `live_id` 并点击开始。
2. 客户端同时请求 FastAPI 启动抓取 (`/api/douyin/start`) 与转写 (`/api/transcription/start`)。
3. 后端实时推送弹幕与转写结果到桌面端，显示字幕与互动数据。
4. 调度器每 5 分钟汇总当前窗口数据，通过 DeepSeek V3.1 AILLM 返回运营洞察与应对话术，显示在提示区域。
5. 若窗口内判定冷场事件，客户端立即弹出高优先级话术建议。
6. 直播结束后（手动停止或抓取线程断开），系统自动生成完整复盘并落库供查询。

## 5. 功能需求明细

### 5.1 Douyin 抓取能力

- 输入：`live_id`，可选 Cookie。
- 输出：统一事件 JSON（chat/gift/room_rank）。
- SLA：连接断开自动重试 3 次，失败告警。

### 5.2 AST 语音转写

- 输入：本地音频流（默认麦克风），支持选择设备。
- 输出：实时文本，附时间戳与置信度。
- SLA：延迟 < 1.5 秒，准确率 ≥ 85%（在模拟数据上验证）。

### 5.3 AI 异步分析

- 模型：DeepSeek V3.1 AILLM（私有部署或 API 调用）。
- 任务调度：`asyncio` 定时器按 5 分钟窗口执行，支持并行队列。
- Prompt 要素：
  1. 窗口内弹幕总数、礼物数、热词词频 TOP5。
  2. AST 文本摘要（自动压缩至 300 字以内）。
  3. 最近一次主播情绪或语速标签（如有）。
- 输出字段：`analysis_summary`、`actionable_tips[]`（含优先级/场景）、`cold_event`（布尔）。
- 冷场检测标准：
  - 弹幕条数 ≤ 5 且连续 30 秒无弹幕。
  - AST 检测语音 RMS < 阈值或静音标记 ≥ 30 秒。
  - 满足条件立即触发 AILLM 请求，输出应急话术。

### 5.4 直播复盘报告

- 触发：手动停止或抓取线程关闭事件。
- Prompt：全量弹幕摘要、整场 AST 文本、核心指标（总弹幕、平均互动、热词）。
- 输出：
  - `performance_overview`：互动表现（好/中/差）+数据支撑。
  - `issue_analysis`：3 条以内问题描述。
  - `improvement_plan`：3-5 条行动建议（含优先级、预期效果）。
  - `highlight_clips`：可选标记高互动时间段。

### 5.5 Electron 客户端

- 面板布局：
  1. 左侧弹幕流（实时更新，支持筛选冷场标记）。
  2. 底部字幕栏（AST 结果）。
  3. 右侧 AI 提示区：实时建议 + 5 分钟分析卡片。
  4. 顶部状态栏：服务状态、窗口倒计时、冷场告警灯。
- 操作：启动/停止、设备选择、导出复盘。
- 数据缓存：本地存储最近 10 场直播记录。

## 6. 系统架构（快速版）

- Electron 主进程：启动/监控 Flask + FastAPI 服务，处理本地日志。
- 渲染进程：通过 IPC 调用后端 API，订阅 WebSocket/SSE。
- FastAPI：
  - `/api/douyin` 控制 DouyinLiveService。
  - `/api/transcription` 控制 ASTService。
  - `/api/ai/insight` & `/api/ai/summary` 调度 DeepSeek V3.1。
- Flask：提供评论存储、热词统计、历史复盘 CRUD。
- AI Worker：协程池 + 重试机制，所有请求落日志并缓存结果。

## 7. 数据与指标

| 指标             | 目标值    | 说明                              |
| ---------------- | --------- | --------------------------------- |
| 实时弹幕延迟     | ≤ 1 秒   | 从 Douyin socket 到 Electron 展示 |
| 转写延迟         | ≤ 1.5 秒 | 麦克风输入到字幕展示              |
| 冷场响应时间     | ≤ 8 秒   | 检测到条件到提示展示              |
| 5 分钟分析准确率 | ≥ 80%    | 运营团队主观评分                  |
| 复盘生成速度     | ≤ 60 秒  | 直播结束到报告可用                |

## 8. 里程碑（4 周）

1. **第 1 周**：梳理现有模块接口，完成 MVP 架构联调脚本。
2. **第 2 周**：实现 5 分钟分析调度 & 冷场检测，接入 DeepSeek AILLM。
3. **第 3 周**：完善 Electron UI，打通实时提示与复盘生成。
4. **第 4 周**：QA 测试、性能压测、准备上线脚本与操作手册。

## 9. 风险与对策

- DeepSeek API 稳定性：增加重试与降级（本地模板提示）。
- 抖音接口变更：保留人工 Cookie 更新手段，设置监控告警。
- 麦克风权限/音频噪声：提供设备校验与噪声过滤阈值配置。
- 数据隐私：所有资料存储本地，导出需用户确认。

## 10. 验收标准

- 单场直播 ≥ 30 分钟内，系统成功输出 ≥ 4 个 5 分钟分析卡片，且冷场提示在真实冷场出现时触发。
- 直播结束后 1 分钟内生成复盘报告，运营评分 ≥ 3/5。
- 客户端运行 2 小时无崩溃，资源占用 CPU<40%、内存<1.5GB。

---

**文档版本**: Quick Launch PRD v1.0
**作者**: 产品团队
**日期**: 2025-09-22
